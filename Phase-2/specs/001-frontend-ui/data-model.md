# Data Model: Frontend UI

**Feature**: Frontend UI for Todo Web Application
**Branch**: `001-frontend-ui`
**Date**: 2026-01-08

---

## Overview

This document defines the frontend data models (TypeScript interfaces) for the Todo Web Application. These models represent the shape of data received from the backend API and managed in the frontend state. All models align with the REST API contracts and constitutional principles of user ownership and data isolation.

---

## Core Entities

### 1. User

Represents an authenticated user in the system.

```typescript
interface User {
  id: string;           // UUID generated by backend
  email: string;        // User's email address (unique identifier)
  createdAt: string;    // ISO 8601 timestamp of account creation
}
```

**Field Specifications**:
- `id`: UUID string (e.g., `"550e8400-e29b-41d4-a716-446655440000"`), backend-generated, immutable
- `email`: Valid email address matching regex `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`, unique across users
- `createdAt`: ISO 8601 timestamp (e.g., `"2026-01-08T10:30:00.000Z"`), backend-generated, immutable

**Validation Rules** (frontend):
- Email format validated client-side during signup/login
- ID and createdAt are read-only, never modified by frontend

**Source**: Received from `/api/auth/signup` and `/api/auth/login` responses

**Storage**: User object stored in AuthContext after successful authentication, cleared on logout

---

### 2. Task

Represents a single todo task belonging to a user.

```typescript
interface Task {
  id: string;           // UUID generated by backend
  title: string;        // Task description (1-255 characters)
  completed: boolean;   // Completion status (true = completed, false = incomplete)
  userId: string;       // Owner's user ID (foreign key reference)
  createdAt: string;    // ISO 8601 timestamp of task creation
  updatedAt: string;    // ISO 8601 timestamp of last modification
}
```

**Field Specifications**:
- `id`: UUID string, backend-generated, immutable
- `title`: String, 1-255 characters, whitespace trimmed, non-empty
- `completed`: Boolean (`true` or `false`), defaults to `false` on creation
- `userId`: UUID string matching authenticated user's ID (backend enforces ownership)
- `createdAt`: ISO 8601 timestamp, backend-generated, immutable
- `updatedAt`: ISO 8601 timestamp, backend-managed, updated on every modification

**Validation Rules** (frontend):
- Title: Required, min 1 character, max 255 characters, trimmed of leading/trailing whitespace
- Completed: Must be boolean (no null/undefined); toggled via PATCH `/api/tasks/:id/toggle`
- Timestamps: Read-only, displayed in human-readable format (e.g., "2 hours ago", "Jan 8, 2026")

**State Transitions**:
1. **Created**: `{ completed: false }` (all new tasks start incomplete)
2. **Toggled to complete**: `{ completed: true }`
3. **Toggled back to incomplete**: `{ completed: false }`
4. **Edited**: `title` updated, `updatedAt` refreshed by backend
5. **Deleted**: Removed from list, no longer exists

**Source**: Received from `/api/tasks` (list), `/api/tasks/:id` (get), POST/PATCH responses (create/update)

**Storage**: Array of Task objects stored in component state (dashboard page), re-fetched on page load

---

## Auxiliary Types

### 3. AuthState

Represents the current authentication state in the frontend application.

```typescript
interface AuthState {
  user: User | null;         // Current authenticated user (null if logged out)
  token: string | null;      // JWT token string (null if logged out)
  isAuthenticated: boolean;  // Derived flag (true if token exists and valid)
  isLoading: boolean;        // Auth initialization/verification in progress
}
```

**Field Specifications**:
- `user`: User object or `null` (null when unauthenticated)
- `token`: JWT string or `null` (stored in localStorage or cookie)
- `isAuthenticated`: Computed from `token !== null` (not stored, always derived)
- `isLoading`: Boolean indicating async auth operations in progress (initial load, login, signup)

**State Lifecycle**:
1. **Initial Load**: `{ user: null, token: null, isAuthenticated: false, isLoading: true }`
2. **Auth Check Complete (no token)**: `{ user: null, token: null, isAuthenticated: false, isLoading: false }`
3. **Auth Check Complete (token found)**: `{ user: User, token: string, isAuthenticated: true, isLoading: false }`
4. **After Login/Signup**: `{ user: User, token: string, isAuthenticated: true, isLoading: false }`
5. **After Logout**: `{ user: null, token: null, isAuthenticated: false, isLoading: false }`

**Usage**: Provided by AuthContext, consumed by AuthGuard and components needing auth state

---

### 4. Form Input Types

Represent the shape of form data submitted by users.

#### LoginCredentials
```typescript
interface LoginCredentials {
  email: string;       // User's email address
  password: string;    // User's password (min 8 characters)
}
```

**Validation** (Zod schema):
```typescript
const loginSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
});
```

**Source**: Login form (`app/(auth)/login/page.tsx`)

---

#### SignupCredentials
```typescript
interface SignupCredentials {
  email: string;          // User's email address
  password: string;       // User's password (min 8 characters)
  confirmPassword: string; // Password confirmation (must match password)
}
```

**Validation** (Zod schema):
```typescript
const signupSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
  confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
  message: "Passwords don't match",
  path: ['confirmPassword'], // Attach error to confirmPassword field
});
```

**Source**: Signup form (`app/(auth)/signup/page.tsx`)

**Note**: `confirmPassword` is frontend-only validation; backend API only receives `email` and `password`

---

#### CreateTaskInput
```typescript
interface CreateTaskInput {
  title: string;  // Task title (1-255 characters, trimmed)
}
```

**Validation** (Zod schema):
```typescript
const createTaskSchema = z.object({
  title: z.string()
    .min(1, 'Task title is required')
    .max(255, 'Task title must be less than 255 characters')
    .trim(),
});
```

**Source**: Task creation form (dashboard page)

---

#### UpdateTaskInput
```typescript
interface UpdateTaskInput {
  title: string;  // Updated task title (1-255 characters, trimmed)
}
```

**Validation** (Zod schema):
```typescript
const updateTaskSchema = z.object({
  title: z.string()
    .min(1, 'Task title is required')
    .max(255, 'Task title must be less than 255 characters')
    .trim(),
});
```

**Source**: Task edit form (inline editor or modal)

---

## Derived Types

### 5. API Response Wrappers

Types for API responses to ensure type safety in API client functions.

```typescript
// Auth endpoints
interface AuthResponse {
  user: User;
  token: string;
}

// Task list endpoint
interface TaskListResponse {
  tasks: Task[];
}

// Single task endpoints (GET, POST, PATCH)
interface TaskResponse {
  task: Task;
}

// Error responses
interface APIErrorResponse {
  error: string;           // Human-readable error message
  code: string;            // Machine-readable error code (e.g., "VALIDATION_ERROR")
  details?: Record<string, string[]>; // Field-specific validation errors (optional)
}
```

**Usage**: Type parameters for `apiClient<T>()` calls

**Example**:
```typescript
// Login API call
const response = await apiClient<AuthResponse>('/api/auth/login', {
  method: 'POST',
  body: JSON.stringify({ email, password }),
});
// response.user and response.token are typed correctly
```

---

## State Transitions

### Task State Diagram

```
┌─────────────────────────────────────────────────────┐
│                  Task Lifecycle                      │
└─────────────────────────────────────────────────────┘

   [Create Task]
        │
        v
   ┌─────────────────┐
   │  completed: false│◄────┐
   │  (Incomplete)    │     │
   └─────────────────┘     │
        │                  │
        │ [Toggle]         │ [Toggle]
        v                  │
   ┌─────────────────┐     │
   │  completed: true │─────┘
   │  (Complete)      │
   └─────────────────┘
        │
        │ [Delete]
        v
   [Task Removed]
```

**Allowed Transitions**:
- Create → Incomplete (`completed: false`)
- Incomplete ↔ Complete (toggle via PATCH `/api/tasks/:id/toggle`)
- Any State → Deleted (DELETE `/api/tasks/:id`)
- Incomplete → Edited (PATCH `/api/tasks/:id` with new title)
- Complete → Edited (PATCH `/api/tasks/:id` with new title)

**Forbidden Transitions** (enforced by backend):
- Direct modification of `id`, `userId`, `createdAt` (immutable)
- Direct modification of `updatedAt` (backend-managed)
- Deletion or modification of tasks owned by other users (401/403 response)

---

## Relationships

```
User (1) ───────< (N) Task
 │                     │
 │                     │
 id ◄──────────────── userId
```

**Relationship Rules**:
- One User owns zero or many Tasks
- One Task belongs to exactly one User
- Orphaned tasks are prevented by backend (cascading delete)
- Frontend never displays tasks where `task.userId !== user.id` (backend enforces with filtering)

---

## Validation Summary

| Field | Type | Required | Min | Max | Format | Immutable |
|-------|------|----------|-----|-----|--------|-----------|
| User.id | string | ✅ | 36 | 36 | UUID | ✅ |
| User.email | string | ✅ | 3 | 254 | Email regex | ❌ (backend) |
| User.createdAt | string | ✅ | - | - | ISO 8601 | ✅ |
| Task.id | string | ✅ | 36 | 36 | UUID | ✅ |
| Task.title | string | ✅ | 1 | 255 | Plain text | ❌ |
| Task.completed | boolean | ✅ | - | - | true/false | ❌ |
| Task.userId | string | ✅ | 36 | 36 | UUID | ✅ |
| Task.createdAt | string | ✅ | - | - | ISO 8601 | ✅ |
| Task.updatedAt | string | ✅ | - | - | ISO 8601 | ✅ (backend) |

**Frontend Validation Scope**:
- Email format, password length, task title length/emptiness
- Password confirmation match (signup only)
- Zod schemas enforce these rules before API submission

**Backend Validation Scope** (trusted by frontend):
- Email uniqueness, password hashing, UUID generation
- User ownership enforcement, cascading deletes
- Timestamp generation, task limits (if any)

---

## TypeScript Type File Organization

```typescript
// lib/types/auth.ts
export interface User { /* ... */ }
export interface AuthState { /* ... */ }
export interface LoginCredentials { /* ... */ }
export interface SignupCredentials { /* ... */ }
export interface AuthResponse { /* ... */ }

// lib/types/task.ts
export interface Task { /* ... */ }
export interface CreateTaskInput { /* ... */ }
export interface UpdateTaskInput { /* ... */ }
export interface TaskListResponse { /* ... */ }
export interface TaskResponse { /* ... */ }

// lib/types/api.ts
export interface APIErrorResponse { /* ... */ }
export class APIError extends Error { /* ... */ }
```

---

## Next Steps

1. ✅ Data model defined with TypeScript interfaces
2. → Create `contracts/api-client.md` with API endpoint specifications
3. → Create `quickstart.md` with development setup guide
4. → Implement types in `lib/types/` directory during task execution
